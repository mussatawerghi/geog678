!function(a){a.fn.storymap=function(b){function e(b,c){var d=a(window).scrollTop(),e=a(b).offset().top,f=e-d,g=c-f;return g<0?a(document).height():g}function f(b,c){function f(a,b){return a.distance>b.distance?b:a}var d=a.map(b,function(b){var d=e(b,c);return{el:a(b),distance:d}}),g=d.reduce(f);a.each(b,function(b,c){var d=a(c);d[0]!==g.el[0]&&d.trigger("notviewing")}),g.el.hasClass("viewing")||g.el.trigger("viewing")}function g(b,c,d){var e=b.find(c);f(e,d),a(window).scroll(function(){f(e,d)})}var c={selector:"[data-scene]",breakpointPos:"33.333%",legend:!1,createMap:function(){var a=L.map("map",{zoomControl:!1}).setView([44,-120],7);return L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw",{maxZoom:18,attribution:"",id:"mapbox.light"}).addTo(a),a}},d=a.extend(c,b);if("undefined"==typeof L)throw new Error("Storymap requires Laeaflet");var h=function(b,c,e){function o(a){m.clearLayers(),1==d.legend&&n.remove();var b=c[a],f=b.layers,g="";if("undefined"!=typeof f)for(var h=0;h<f.length;h++)m.addLayer(e[f[h]][0]),2==e[f[h]].length&&(g+=e[f[h]][1]);n.onAdd=function(){var a=new L.DomUtil.create("div","legend");return a.innerHTML=g,a},1==d.legend&&""!=g&&n.addTo(l),l.setView([b.lat,b.lng],b.zoom,1)}var f=a('<div class="breakpoint-current"></div>').css("top",d.breakpointPos);a("body").append(f);var h=f.offset().top-a(window).scrollTop(),i=d.selector,j=b.find(i);j.on("viewing",function(){a(this).addClass("viewing")}),j.on("notviewing",function(){a(this).removeClass("viewing")}),g(b,i,h);var k=b.find(".arrow-down");k.click(function(){window.scrollBy(0,a(window).height()/3)});var l=d.createMap(),m=L.layerGroup().addTo(l),n=L.control({position:"topright"});a.each(j,function(b,f){var g=a(f);if("viewing"==g[0].className){var h=c[g[0].attributes["data-scene"].value];l.setView([h.lat,h.lng],h.zoom);var i=h.layers,j="";if("undefined"!=typeof i)for(var k=0;k<i.length;k++)m.addLayer(e[i[k]][0]),2==e[i[k]].length&&(j+=e[i[k]][1]);n.onAdd=function(){var a=new L.DomUtil.create("div","legend");return a.innerHTML=j,a},1==d.legend&&""!=j&&n.addTo(l)}}),j.on("viewing",function(){o(a(this).data("scene"))})};return h(this,d.scenes,d.layers),this}}(jQuery);